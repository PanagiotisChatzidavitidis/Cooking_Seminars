<html>
<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="../bootstrap/bootstrap.min.css">
  <link rel="stylesheet" href="../css/style.css?v=<?php echo time(); ?>">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Varela+Round|Open+Sans">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="user_administration.css">
  <script src="../js/jquery-3.7.0.min.js"></script>
  <script src="../js/script.js"></script>

    <link rel="stylesheet" href="../bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="../css/style.css?v=<?php echo time(); ?>">
    
</head>

<body>
    <header>
        <img src="../images/CR_transparent.png" width="200">
        <button class="btn btn-sign-out" onclick="location.href='home.html'">Sign Out</button> 
        
    </header>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="admin_home.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="admin_seminar_preview.html">Seminar-Preview</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="admin_seminars.html">Seminar-Administration</a>
            </li>
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="user_administration.html">Users</a>
            </li>
          </ul>
            <form class="d-flex" role="search">
              <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
              <button class="btn btn-outline-success" type="submit" style="color: white; background-color: transparent; border-color: white;">Search</button>
            </form>
          </div>
        </div>
      </nav>

    <!-- Display Users -->
    <div id="userContainer" class="container" style="position: relative; right: 230px;">
      <h3 style="position: relative; left: -90px; top: 20px;">Users</h3>
      <div class="row" style="position: relative; left: -90px; top: 20px;">
        <!-- User data will be dynamically added here -->
      </div>
    </div>
    <!--Create User -->
    <div class="container mt-5">
      <h2 class="text-center mb-4">Create new User</h2>
      <form>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="firstName">First Name:</label>
              <input type="text" class="form-control" id="firstName" name="firstName" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="lastName">Last Name:</label>
              <input type="text" class="form-control" id="lastName" name="lastName" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="username">Username:</label>
              <input type="text" class="form-control" id="username" name="username" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="email">Email:</label>
              <input type="email" class="form-control" id="email" name="email" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="password">Password:</label>
              <input type="password" class="form-control" id="password" name="password" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="gender">Gender:</label>
              <select class="form-control" id="gender" name="gender" required>
                <option value="">Select</option>
                <option value="female">Female</option>
                <option value="male">Male</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="country">Country:</label>
              <input type="text" class="form-control" id="country" name="country" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="city">City:</label>
              <input type="text" class="form-control" id="city" name="city" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="address">Address:</label>
              <input type="text" class="form-control" id="address" name="address" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="phone">Phone:</label>
              <input type="text" class="form-control" id="phone" name="phone" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="trait">Trait:</label>
              <select class="form-control" id="trait" name="trait" required>
                <option value="">Select</option>
                <option value="User">User</option>
                <option value="Admin">Admin</option>
              </select>
            </div>
          </div>
        </div>
        <button type="button" class="btn-sign btn btn-primary " onclick="submitForm()">Create User</button>
      </form>
    </div>
    <!--Update User -->
    <div class="container" style="position: relative; top: 20px;">
      <h3>Update User</h3>
      <form id="updateForm">
        <div class="form-group">
          <label>Username:</label>
          <select id="userDropdownUpdate" class="form-select mb-3">
            <option selected>Select a username</option>
          </select>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="firstName_update">First Name:</label>
              <input type="text" class="form-control" id="firstName_update" name="firstName" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="lastName_update">Last Name:</label>
              <input type="text" class="form-control" id="lastName_update" name="lastName" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="country_update">Country:</label>
              <input type="text" class="form-control" id="country_update" name="country_update" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="city_update">City:</label>
              <input type="text" class="form-control" id="city_update" name="city_update" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="address_update">Address:</label>
              <input type="text" class="form-control" id="address_update" name="address" required>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="phone_update">Phone:</label>
              <input type="tel" class="form-control" id="phone_update" name="phone" required>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label for="gender_update">Gender:</label>
              <select class="form-control" id="gender_update" name="gender_update" required>
                <option value="">Select</option>
                <option value="female">Female</option>
                <option value="male">Male</option>
                <option value="other">Other</option>
              </select>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group">
              <label for="trait_update">Trait:</label>
              <select class="form-control" id="trait_update" name="trait_update" required>
                <option value="">Select</option>
                <option value="User">User</option>
                <option value="Admin">Admin</option>
              </select>
            </div>
          </div>
        </div>
        <button type="submit" class="btn btn-primary btn-sign">Update</button>
      </form>
    </div>

    <!--Delete User -->
    <div class ="container" style="position: relative; top: 50px;">
      <div class="row">
        <div class="col-md-6">
          <h3>Delete User</h3>
          <select id="userDropdown" class="form-select mb-3">
            <option selected>Select a username</option>
          </select>
          <button id="deleteButton" class="btn btn-sign-out" style="position: relative; left: 110px;top: -70px;">Delete</button>
        </div>
      </div>
    </div>


    
  
    <script>
      // Fetch user data
      fetch('http://localhost:3000/users')
        .then(response => response.json())
        .then(data => {
          const userContainer = document.querySelector('.row');
          let usersData = data; // Store the original user data
    
          // Create HTML elements to display user data in a table
          const table = document.createElement('table');
          table.classList.add('table', 'table-striped', 'wider-table');
    
          // Create table header
          const thead = document.createElement('thead');
          const headerRow = document.createElement('tr');
          const headers = ['Username', 'Name', 'Last Name', 'Email', 'Gender', 'Country', 'City', 'Address', 'Phone', 'Trait'];
    
          headers.forEach(headerText => {
            const th = document.createElement('th');
            th.textContent = headerText;
            headerRow.appendChild(th);
          });
    
          thead.appendChild(headerRow);
          table.appendChild(thead);
    
          // Create table body
          const tbody = document.createElement('tbody');
    
          const displayUsers = (users) => {
            // Clear existing table body
            tbody.innerHTML = '';
    
            // Clear existing dropdown options
            const userDropdown = document.getElementById('userDropdown');
            userDropdown.innerHTML = '<option selected>Select a username</option>';
    
            users.forEach(user => {
              const row = document.createElement('tr');
    
              // Create table cells and set user data
              const usernameCell = document.createElement('td');
              usernameCell.textContent = user.username;
    
              const firstNameCell = document.createElement('td');
              firstNameCell.textContent = user.firstName;
    
              const lastNameCell = document.createElement('td');
              lastNameCell.textContent = user.lastName;
    
              const emailCell = document.createElement('td');
              emailCell.textContent = user.email;
    
              const genderCell = document.createElement('td');
              genderCell.textContent = user.gender;
    
              const countryCell = document.createElement('td');
              countryCell.textContent = user.country;
    
              const cityCell = document.createElement('td');
              cityCell.textContent = user.city;
    
              const addressCell = document.createElement('td');
              addressCell.textContent = user.address;
    
              const phoneCell = document.createElement('td');
              phoneCell.textContent = user.phone;
    
              const traitCell = document.createElement('td');
              traitCell.textContent = user.trait;
    
              // Append cells to the row
              row.appendChild(usernameCell);
              row.appendChild(firstNameCell);
              row.appendChild(lastNameCell);
              row.appendChild(emailCell);
              row.appendChild(genderCell);
              row.appendChild(countryCell);
              row.appendChild(cityCell);
              row.appendChild(addressCell);
              row.appendChild(phoneCell);
              row.appendChild(traitCell);
    
              // Append row to the table body
              tbody.appendChild(row);
    
              // Add username to dropdown options
              const option = document.createElement('option');
              option.textContent = user.username;
              userDropdown.appendChild(option);
            });
    
            table.appendChild(tbody);
          };
    
          // Display all users initially
          displayUsers(usersData);
    
          const col = document.createElement('div');
          col.classList.add('col-md-8', 'mb-4');
          col.appendChild(table);
    
          userContainer.appendChild(col);
    
          // Delete functionality
          const deleteButton = document.getElementById('deleteButton');
          const userDropdown = document.getElementById('userDropdown');
    
          deleteButton.addEventListener('click', () => {
            const selectedUsername = userDropdown.value;
    
            if (selectedUsername === 'Select a username') {
              alert('Please select a username to delete.');
              return;
            }
    
            const deleteUser = usersData.find(user => user.username === selectedUsername);
    
            if (deleteUser) {
              const confirmation = confirm(`Are you sure you want to delete the user ${deleteUser.username}?`);
    
              if (confirmation) {
                // Make DELETE request to the server
                fetch(`http://localhost:3000/users/${deleteUser._id}`, { method: 'DELETE' })
                  .then(response => response.json())
                  .then(data => {
                    alert('User deleted successfully.');
    
                    // Remove the deleted user from the user data
                    usersData = usersData.filter(user => user.username !== selectedUsername);
    
                    // Update the displayed users and reset the dropdown
                    displayUsers(usersData);
                    userDropdown.value = 'Select a username';
                  })
                  .catch(error => {
                    console.error('Error deleting user:', error);
                  });
              }
            }
          });
        })
        .catch(error => {
          console.error('Error fetching user data:', error);
        });

        function submitForm() {
          const firstName = document.getElementById('firstName').value;
          const lastName = document.getElementById('lastName').value;
          const username = document.getElementById('username').value;
          const email = document.getElementById('email').value;
          const password = document.getElementById('password').value;
          const gender = document.getElementById('gender').value;
          const country = document.getElementById('country').value;
          const city = document.getElementById('city').value;
          const address = document.getElementById('address').value;
          const phone = document.getElementById('phone').value;
          const trait = document.getElementById('trait').value;
      
          const userData = {
            firstName: firstName,
            lastName: lastName,
            username: username,
            email: email,
            password: password,
            gender: gender,
            country: country,
            city: city,
            address: address,
            phone: phone,
            trait: trait
          };
      
          fetch('http://localhost:3000/users', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(userData)
          })
            .then(response => response.json())
            .then(data => {
              console.log('User created:', data);
              // You can perform additional actions after creating the user
              // For example, redirect to a success page or perform login
            })
            .catch(error => {
              console.error('Error creating user:', error);
              // Handle the error, display an error message, etc.
            });
        }
        
        //Update

        const updateForm = document.getElementById('updateForm');
        const userDropdownUpdate = document.getElementById('userDropdownUpdate');
        
        // Fetch user data for the dropdown
        fetch('http://localhost:3000/users')
          .then(response => response.json())
          .then(data => {
            // Extract the usernames from the user data
            const usernames = data.map(user => user.username);
        
            // Populate the dropdown with usernames
            usernames.forEach(username => {
              const option = document.createElement('option');
              option.value = username;
              option.textContent = username;
              userDropdownUpdate.appendChild(option);
            });
          })
          .catch(error => {
            console.error('Error fetching user data:', error);
          });
        
        // Update functionality
        updateForm.addEventListener('submit', event => {
          event.preventDefault();
        
          const selectedUsername = userDropdownUpdate.value;
          const firstName = document.getElementById('firstName_update').value;
          const lastName = document.getElementById('lastName_update').value;
          const country = document.getElementById('country_update').value;
          const city = document.getElementById('city_update').value;
          const address = document.getElementById('address_update').value;
          const phone = document.getElementById('phone_update').value;
          const gender = document.getElementById('gender_update').value;
          const trait = document.getElementById('trait_update').value;
        
          // Prepare the updated user object
          const updatedUser = {
            firstName,
            lastName,
            gender,
            country,
            city,
            address,
            phone,
            trait
          };
        
          // Perform the update request
          fetch(`http://localhost:3000/users/${selectedUsername}`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(updatedUser)
          })
            .then(response => response.json())
            .then(data => {
              console.log('User updated successfully:', data);
              // Clear the form fields
              updateForm.reset();
            })
            .catch(error => {
              console.error('Error updating user:', error);
            });
        });
        
  </script>
    

    <footer>
      <div class="container">
        <div class="text-center">
            &copy; Delicious Creations 2023. All Rights Reserved.
        </div>
      </div>
    </footer>
</body>
</html>
