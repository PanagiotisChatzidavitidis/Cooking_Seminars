<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="../bootstrap/bootstrap.min.css">
    <link rel="stylesheet" href="../css/style.css?v=<?php echo time(); ?>">

    <script src="../js/jquery-3.7.0.min.js"></script>
    <script src="../js/script.js"></script>
</head>

<body>
    <header>
        <img src="../images/CR_transparent.png" width="200">
        <button class="btn btn-sign-out" onclick="confirmSignOut()">Sign Out</button>
        <button id="toggleDarkMode" style="position: relative; top: 60px; left: 140px;" class="btn btn-primary btn-sign">Dark Mode</button>
    </header>

    <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="user_home.html">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="user_seminar.html">Seminars</a>
              </li>
            </ul>
            <form class="d-flex" role="search">
              <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
              <button class="btn btn-outline-success" type="submit" style="color: white; background-color: transparent; border-color: white;">Search</button>
            </form>
          </div>
        </div>
      </nav>
      <div id="greetingMessage"></div>

      <h3><strong>Your History</strong></h3>
      <div id="reservationsList"></div>

      <script>
        // Retrieve the 'current_user' value from session storage
        const currentUser = sessionStorage.getItem('current_user');
      
        // Check if the 'current_user' value exists
        if (currentUser) {
          // Add the greeting message
          const greetingMessage = document.getElementById('greetingMessage');
          greetingMessage.innerHTML = `<h3>Welcome, ${currentUser}! Good to have you back.</h3>`;
        }

        // Fetch reservations based on the current user
        fetch('http://localhost:3000/reservations/' + currentUser)
          .then(response => response.json())
          .then(data => {
            // Process the reservations data and display it
            const reservationsList = document.getElementById('reservationsList');

            if (data.length === 0) {
              reservationsList.innerHTML = '<p>No reservations found.</p>';
            } else {
              const reservationsHTML = data.map(reservation => {
                return `
                  <div>
                    <h4>Reservation ID: ${reservation._id}</h4>
                    <p>Seminar Name: ${reservation.seminarName}</p>
                    <p>Final Cost: ${reservation.finalCost} â‚¬</p>
                    <p>Seating Type: ${reservation.Type}</p>
                    <p>Quantity: ${reservation.Quantity}</p>
                  </div>
                  <hr>
                `;
              }).join('');

              reservationsList.innerHTML = reservationsHTML;
            }
          })
          .catch(error => {
            console.error('Error retrieving reservations:', error);
          });
      </script>

    <footer>
      <div class="container">
        <div class="text-center">
            &copy; Delicious Creations 2023. All Rights Reserved.
        </div>
    </div>
    </footer>
    
</body>
</html>
